---
title: "Custom functions for the customer churn workflow"
output: html_document
---

# About

`targets` can watch input files, output files, and literate programming documents for changes. This chapter explores how to configure a target to automatically run when a file changes.

# Setup

Load this chapter's quiz questions. Try not to peek in advance.

```{r}
source("R/quiz.R")
source("4-files/answers.R")
```

Run the following command to write the required `_targets.R` script to the your working directory.

```{r, echo = FALSE}
file.copy("4-files/initial_targets.R", "_targets.R", overwrite = TRUE)
```

Run `tar_destroy()` to remove the targets from the previous chapter.

```{r}
library(targets)
tar_destroy()
```

Open `_targets.R` for editing

```{r}
library(usethis)
edit_file("_targets.R", open = TRUE)
```

# Review

As we saw in `3-changes.Rmd`, `targets` can watch files like `data/churn.csv` for changes. Let's review how this works. First, run the full pipeline from start to finish.

```{r}
tar_make()
```

Verify that all targets are now up to date.

```{r}
tar_make()
```

Now, open the customer churn data file for editing. Manually remove the last line of data in the file.

```{r}
edit_file("data/churn.csv")
```

When we call `tar_make()` again, all targets should rerun because they all depend on the upstream file target `churn_file`.

```{r}
tar_make()
```

How do we configure `churn_file` and everything downstream to rerun when `data/churn.csv` changes?

A. The target's return value needs to be a character vector of file and directory paths. These paths get resolved at runtime, so we do not need to know them before we call `tar_make()`. 
B. In `tar_target()`, set the `format` argument equal to `"file"`. That way, `tar_make()` knows the return value of `churn_file` is a bunch of file paths that need to be watched.
C. Targets directly downstream need to mention the symbol `churn_file` (as opposed to the literal path `"data/churn.csv"`) so `tar_make()` can discover the correct dependnecy relationships among targets. Always check with `tar_visnetwork()` to verify that your targets are connected propoerly in the dependency graph.
D. All the above.

```{r}
answer_review("E")
```
